{{/*  Source: https://gitlab.com/Roneo/hugo-shortcode-roneo-fetch-archive.org  */}}

{{- $src := .Get "src" -}}
{{ $dataJ := getJSON $src }}
{{- $identifier := $dataJ.metadata.identifier -}}
{{- $root := "https://archive.org/download" -}}

{{ range $dataJ.files }}
  <ul>

    {{/*  Show only MP3 files  */}}
    {{ if eq .format "VBR MP3" }}
      <li>
        {{$path := print $root "/" $identifier "/" .name}}
        <a href="{{ $path }}" target="_blank" aria-label="Télécharger {{ index .name }}" download>{{ index .name }}</a>
        <br>

          {{/*  Embed HTML player  */}}
          <figure>
            <audio controls class="player">
              <source src="{{- $path -}}" type="audio/mpeg">
            </audio>
          </figure>

          {{/*  Add a label depending on metadata  */}}
          {{/*  {{ if in .source "original" }}
            <b>ORIGINAL</b>
          {{ end }}  */}}

          {{/*  Add a label depending on filetype  */}}
          {{/*  {{ if in .format "Text PDF" }}
            <b>PDF</b>
          {{ end }}  */}}

        </li>
    {{ end }}
  </ul>
{{ end }}
